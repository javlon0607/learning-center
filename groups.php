<?php require 'config.php';auth();if($_SERVER['REQUEST_METHOD']==='POST'){$a=$_POST['action']??'';if($a==='create')db()->prepare("INSERT INTO groups(name,subject,teacher_id,capacity,price)VALUES(?,?,?,?,?)")->execute([$_POST['name'],$_POST['subject'],$_POST['teacher_id'],$_POST['capacity'],$_POST['price']]);elseif($a==='update')db()->prepare("UPDATE groups SET name=?,subject=?,teacher_id=?,capacity=?,price=?,status=? WHERE id=?")->execute([$_POST['name'],$_POST['subject'],$_POST['teacher_id'],$_POST['capacity'],$_POST['price'],$_POST['status'],$_POST['id']]);elseif($a==='delete')db()->prepare("DELETE FROM groups WHERE id=?")->execute([$_POST['id']]);header('Location: groups.php');exit;}$groups=db()->query("SELECT g.*,t.first_name||' '||t.last_name as teacher FROM groups g LEFT JOIN teachers t ON g.teacher_id=t.id ORDER BY g.created_at DESC")->fetchAll();$teachers=db()->query("SELECT id,first_name||' '||last_name as name FROM teachers WHERE status='active'")->fetchAll();?>
<!DOCTYPE html><html><head><title>Groups</title><script src="https://cdn.tailwindcss.com"></script><script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script></head><body class="bg-gray-100" x-data="{modal:false,form:{},edit:false}"><div class="flex"><nav class="bg-gray-800 text-white w-64 min-h-screen p-4"><h2 class="text-xl font-bold mb-6">Learning CRM</h2><a href="dashboard.php" class="block py-2 px-4 hover:bg-gray-700 rounded mb-2">ğŸ“Š Dashboard</a><a href="students.php" class="block py-2 px-4 hover:bg-gray-700 rounded mb-2">ğŸ‘¥ Students</a><a href="teachers.php" class="block py-2 px-4 hover:bg-gray-700 rounded mb-2">ğŸ‘¨â€ğŸ« Teachers</a><a href="groups.php" class="block py-2 px-4 bg-gray-700 rounded mb-2">ğŸ“š Groups</a><a href="payments.php" class="block py-2 px-4 hover:bg-gray-700 rounded mb-2">ğŸ’° Payments</a><a href="expenses.php" class="block py-2 px-4 hover:bg-gray-700 rounded mb-2">ğŸ“‰ Expenses</a><a href="logout.php" class="block py-2 px-4 hover:bg-red-700 rounded mt-4">ğŸšª Logout</a></nav><main class="flex-1 p-8"><div class="flex justify-between items-center mb-8"><h1 class="text-3xl font-bold">Groups</h1><button @click="modal=true;form={};edit=false" class="bg-blue-600 text-white px-4 py-2 rounded">+ Add Group</button></div><div class="grid grid-cols-3 gap-6"><?php foreach($groups as $g): ?><div class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-bold mb-2"><?=htmlspecialchars($g['name'])?></h3><p class="text-gray-600 mb-2"><?=$g['subject']?></p><p class="text-sm mb-1">Teacher: <?=$g['teacher']??'Not assigned'?></p><p class="text-sm mb-1">Capacity: <?=$g['capacity']?></p><p class="text-lg font-bold text-green-600 mb-3">$<?=number_format($g['price'],2)?>/mo</p><div class="flex space-x-2"><button @click="form=<?=htmlspecialchars(json_encode($g))?>;modal=true;edit=true" class="text-blue-600">Edit</button><form method="POST" class="inline" onsubmit="return confirm('Delete?')"><input type="hidden" name="action" value="delete"><input type="hidden" name="id" value="<?=$g['id']?>"><button class="text-red-600">Delete</button></form></div></div><?php endforeach; ?></div><div x-show="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center" x-cloak style="display:none"><div class="bg-white rounded-lg p-8 w-2/3" @click.away="modal=false"><h2 class="text-2xl font-bold mb-4" x-text="edit?'Edit Group':'Add Group'"></h2><form method="POST"><input type="hidden" name="action" :value="edit?'update':'create'"><input type="hidden" name="id" x-model="form.id"><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm mb-1">Group Name*</label><input type="text" name="name" x-model="form.name" class="w-full border rounded px-3 py-2" required></div><div><label class="block text-sm mb-1">Subject*</label><input type="text" name="subject" x-model="form.subject" class="w-full border rounded px-3 py-2" required></div><div><label class="block text-sm mb-1">Teacher</label><select name="teacher_id" x-model="form.teacher_id" class="w-full border rounded px-3 py-2"><option value="">Select Teacher</option><?php foreach($teachers as $t):?><option value="<?=$t['id']?>"><?=$t['name']?></option><?php endforeach;?></select></div><div><label class="block text-sm mb-1">Capacity*</label><input type="number" name="capacity" x-model="form.capacity" class="w-full border rounded px-3 py-2" required></div><div><label class="block text-sm mb-1">Price per Month*</label><input type="number" step="0.01" name="price" x-model="form.price" class="w-full border rounded px-3 py-2" required></div><div x-show="edit"><label class="block text-sm mb-1">Status</label><select name="status" x-model="form.status" class="w-full border rounded px-3 py-2"><option value="active">Active</option><option value="completed">Completed</option></select></div></div><div class="flex justify-end space-x-3 mt-6"><button type="button" @click="modal=false" class="px-4 py-2 border rounded">Cancel</button><button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">Save</button></div></form></div></div></main></div></body></html>
