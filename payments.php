<?php require 'config.php';auth();if($_SERVER['REQUEST_METHOD']==='POST'){db()->prepare("INSERT INTO payments(student_id,group_id,amount,payment_date,method,notes)VALUES(?,?,?,?,?,?)")->execute([$_POST['student_id'],$_POST['group_id'],$_POST['amount'],$_POST['payment_date'],$_POST['method'],$_POST['notes']]);header('Location: payments.php');exit;}$payments=db()->query("SELECT p.*,s.first_name||' '||s.last_name as student,g.name as grp FROM payments p JOIN students s ON p.student_id=s.id LEFT JOIN groups g ON p.group_id=g.id ORDER BY p.payment_date DESC LIMIT 100")->fetchAll();$students=db()->query("SELECT id,first_name||' '||last_name as name FROM students WHERE status='active'")->fetchAll();$groups=db()->query("SELECT id,name FROM groups WHERE status='active'")->fetchAll();?>
<!DOCTYPE html><html><head><title>Payments</title><script src="https://cdn.tailwindcss.com"></script><script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script></head><body class="bg-gray-100" x-data="{modal:false,form:{payment_date:new Date().toISOString().split('T')[0]}}"><div class="flex"><nav class="bg-gray-800 text-white w-64 min-h-screen p-4"><h2 class="text-xl font-bold mb-6">Learning CRM</h2><a href="dashboard.php" class="block py-2 px-4 hover:bg-gray-700 rounded mb-2">ğŸ“Š Dashboard</a><a href="students.php" class="block py-2 px-4 hover:bg-gray-700 rounded mb-2">ğŸ‘¥ Students</a><a href="teachers.php" class="block py-2 px-4 hover:bg-gray-700 rounded mb-2">ğŸ‘¨â€ğŸ« Teachers</a><a href="groups.php" class="block py-2 px-4 hover:bg-gray-700 rounded mb-2">ğŸ“š Groups</a><a href="payments.php" class="block py-2 px-4 bg-gray-700 rounded mb-2">ğŸ’° Payments</a><a href="expenses.php" class="block py-2 px-4 hover:bg-gray-700 rounded mb-2">ğŸ“‰ Expenses</a><a href="logout.php" class="block py-2 px-4 hover:bg-red-700 rounded mt-4">ğŸšª Logout</a></nav><main class="flex-1 p-8"><div class="flex justify-between items-center mb-8"><h1 class="text-3xl font-bold">Payments</h1><button @click="modal=true;form={payment_date:new Date().toISOString().split('T')[0]}" class="bg-green-600 text-white px-4 py-2 rounded">+ Record Payment</button></div><div class="bg-white rounded-lg shadow overflow-hidden"><table class="w-full"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left">Date</th><th class="px-6 py-3 text-left">Student</th><th class="px-6 py-3 text-left">Group</th><th class="px-6 py-3 text-left">Amount</th><th class="px-6 py-3 text-left">Method</th></tr></thead><tbody class="divide-y"><?php foreach($payments as $p): ?><tr><td class="px-6 py-4"><?=date('M d, Y',strtotime($p['payment_date']))?></td><td class="px-6 py-4"><?=$p['student']?></td><td class="px-6 py-4"><?=$p['grp']??'-'?></td><td class="px-6 py-4 font-bold text-green-600">$<?=number_format($p['amount'],2)?></td><td class="px-6 py-4"><?=$p['method']?></td></tr><?php endforeach; ?></tbody></table></div><div x-show="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center" x-cloak style="display:none"><div class="bg-white rounded-lg p-8 w-2/3" @click.away="modal=false"><h2 class="text-2xl font-bold mb-4">Record Payment</h2><form method="POST"><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm mb-1">Student*</label><select name="student_id" x-model="form.student_id" class="w-full border rounded px-3 py-2" required><option value="">Select Student</option><?php foreach($students as $s):?><option value="<?=$s['id']?>"><?=$s['name']?></option><?php endforeach;?></select></div><div><label class="block text-sm mb-1">Group</label><select name="group_id" x-model="form.group_id" class="w-full border rounded px-3 py-2"><option value="">Select Group</option><?php foreach($groups as $g):?><option value="<?=$g['id']?>"><?=$g['name']?></option><?php endforeach;?></select></div><div><label class="block text-sm mb-1">Amount*</label><input type="number" step="0.01" name="amount" x-model="form.amount" class="w-full border rounded px-3 py-2" required></div><div><label class="block text-sm mb-1">Payment Date*</label><input type="date" name="payment_date" x-model="form.payment_date" class="w-full border rounded px-3 py-2" required></div><div><label class="block text-sm mb-1">Method*</label><select name="method" x-model="form.method" class="w-full border rounded px-3 py-2" required><option value="cash">Cash</option><option value="card">Card</option><option value="bank_transfer">Bank Transfer</option></select></div><div><label class="block text-sm mb-1">Notes</label><textarea name="notes" x-model="form.notes" class="w-full border rounded px-3 py-2" rows="2"></textarea></div></div><div class="flex justify-end space-x-3 mt-6"><button type="button" @click="modal=false" class="px-4 py-2 border rounded">Cancel</button><button type="submit" class="px-4 py-2 bg-green-600 text-white rounded">Save</button></div></form></div></div></main></div></body></html>
